<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정육면체 전개도 통합 시뮬레이터 (11종 / 2번 수정)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: sans-serif;
            display: flex;
        }
        
        /* 왼쪽 썸네일 사이드바 */
        #sidebar {
            width: 200px;
            background: #f4f4f4;
            border-right: 1px solid #ddd;
            padding: 15px;
            box-sizing: border-box;
            height: 100vh;
            overflow-y: auto;
        }
        #sidebar h3 {
            margin-top: 0;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }
        .thumbnail-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
        }
        .thumbnail-btn:hover {
            background: #e9e9e9;
        }
        .thumbnail-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        /* 메인 콘텐츠 영역 (캔버스 + 슬라이더) */
        #main-content {
            flex-grow: 1;
            height: 100vh;
            position: relative;
        }

        /* 3D 캔버스가 들어갈 컨테이너 */
        #canvas-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* 하단 중앙 UI 배치 (캔버스 위에) */
        #ui-container {
            position: absolute;
            bottom: 30px; 
            left: 50%;
            transform: translateX(-50%); 
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 10;
        }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type=range] { width: 200px; }
        .instruction { font-size: 0.9em; color: #555; margin-top: 10px; }
    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="sidebar">
        <h3>전개도 선택</h3>
        <button class="thumbnail-btn active" id="btn-layout-1">전개도 1</button>
        <button class="thumbnail-btn" id="btn-layout-2">전개도 2</button>
        <button class="thumbnail-btn" id="btn-layout-3">전개도 3</button>
        <button class="thumbnail-btn" id="btn-layout-4">전개도 4</button>
        <button class="thumbnail-btn" id="btn-layout-5">전개도 5</button>
        <button class="thumbnail-btn" id="btn-layout-6">전개도 6</button>
        <button class="thumbnail-btn" id="btn-layout-7">전개도 7</button>
        <button class="thumbnail-btn" id="btn-layout-8">전개도 8</button>
        <button class="thumbnail-btn" id="btn-layout-9">전개도 9</button>
        <button class="thumbnail-btn" id="btn-layout-10">전개도 10</button>
        <button class="thumbnail-btn" id="btn-layout-11">전개도 11</button>
    </div>

    <div id="main-content">
        <div id="canvas-container"></div>
        
        <div id="ui-container">
            <label for="foldSlider">전개도 접기/펼치기</label>
            <input type="range" id="foldSlider" min="0" max="90" value="0">
            <div class="instruction">슬라이더를 움직여 보세요.<br>마우스 드래그: 회전 | 휠: 확대/축소</div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- 1. 전역 변수 및 Three.js 기본 설정 ---
        let currentCubeGroup = null;
        let currentUpdateFunction = () => {};
        
        const canvasContainer = document.getElementById('canvas-container');
        const slider = document.getElementById('foldSlider');
        const buttons = document.querySelectorAll('.thumbnail-btn');

        // Scene
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        // Camera
        const camera = new THREE.PerspectiveCamera(45, canvasContainer.clientWidth / canvasContainer.clientHeight, 0.1, 1000);
        camera.position.set(0, 15, 15);

        // Renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
        renderer.shadowMap.enabled = true;
        canvasContainer.appendChild(renderer.domElement);

        // Light
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(10, 20, 10);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // Controls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // --- 2. 헬퍼(Helper) 함수 ---
        const size = 2;
        const offset = size / 2;
        const colorYellow = 0xFFFF00;
        const colorMagenta = 0xFF00FF;
        const colorCyan = 0x00FFFF;

        function createFace(color, name) {
            const geometry = new THREE.BoxGeometry(size, 0.1, size); 
            const material = new THREE.MeshStandardMaterial({ 
                color: color, 
                side: THREE.DoubleSide,
                roughness: 0.5,
                metalness: 0.1
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            const edges = new THREE.EdgesGeometry(geometry);
            const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x000000 }));
            mesh.add(line);
            return mesh;
        }

        function createPivot(x, y, z) {
            const pivot = new THREE.Group();
            pivot.position.set(x, y, z);
            return pivot;
        }

        // --- 3. 각 전개도별 생성 함수 ---

        /** 전개도 1 (1.html): 1-4-1 십자형 (Y-base) */
        function buildLayout1() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotRight = createPivot(offset, 0, 0);
            const faceRight = createFace(colorCyan, "Right");
            faceRight.position.set(offset, 0, 0);
            pivotRight.add(faceRight);
            baseFace.add(pivotRight);

            const pivotLeft = createPivot(-offset, 0, 0);
            const faceLeft = createFace(colorCyan, "Left");
            faceLeft.position.set(-offset, 0, 0);
            pivotLeft.add(faceLeft);
            baseFace.add(pivotLeft);

            const pivotFront = createPivot(0, 0, offset);
            const faceFront = createFace(colorMagenta, "Front");
            faceFront.position.set(0, 0, offset);
            pivotFront.add(faceFront);
            baseFace.add(pivotFront);

            const pivotBack = createPivot(0, 0, -offset);
            const faceBack = createFace(colorMagenta, "Back");
            faceBack.position.set(0, 0, -offset);
            pivotBack.add(faceBack);
            baseFace.add(pivotBack);

            const pivotTop = createPivot(size, 0, 0); 
            const faceTop = createFace(colorYellow, "Top");
            faceTop.position.set(offset, 0, 0);
            pivotTop.add(faceTop);
            pivotRight.add(pivotTop);

            const updateFunc = (angleRad) => {
                pivotRight.rotation.z = angleRad;
                pivotLeft.rotation.z = -angleRad;
                pivotFront.rotation.x = -angleRad;
                pivotBack.rotation.x = angleRad;
                pivotTop.rotation.z = angleRad; 
            };
            
            return { group: baseFace, updateFunc };
        }

        /** [수정] 전개도 2 (2-1.html 코드 적용) */
        function buildLayout2() {
            // 1. 바닥(Base) 면 - 옐로 (1)
            const baseFace = createFace(colorYellow, "Base"); 
            scene.add(baseFace);

            // 2. 왼쪽 면 (West) - 시안 (1)
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            // 3. 뒤쪽 면 (North/Back) - 마젠타 (1)
            // 'faceWest(시안 1)'의 위쪽(North)에 붙음
            const pivotNorth = createPivot(0, 0, -offset); // faceWest 기준
            const faceNorth = createFace(colorMagenta, "North");
            faceNorth.position.set(0, 0, -offset); 
            pivotNorth.add(faceNorth);
            faceWest.add(pivotNorth); // 부모: faceWest

            // 4. 앞쪽 면 (South/Front) - 마젠타 (2)
            // 'faceWest(시안 1)'의 아래쪽(South)에 붙음
            const pivotSouth = createPivot(0, 0, offset); // faceWest 기준
            const faceSouth = createFace(colorMagenta, "Front");
            faceSouth.position.set(0, 0, offset); 
            pivotSouth.add(faceSouth);
            faceWest.add(pivotSouth); // 부모: faceWest

            // 5. 오른쪽 면 (East) - 시안 (2)
            const pivotEast = createPivot(offset, 0, 0);
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0);
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            // 6. 맨 오른쪽 면 (FarEast/Top) - 옐로 (2)
            // 'faceEast(시안 2)'의 오른쪽에 붙음
            const pivotFarEast = createPivot(offset, 0, 0); // faceEast 기준
            const faceFarEast = createFace(colorYellow, "FarEast");
            faceFarEast.position.set(offset, 0, 0);
            pivotFarEast.add(faceFarEast);
            faceEast.add(pivotFarEast); // 부모: faceEast
            
            const updateFunc = (angleRad) => {
                // T자형 회전 로직 (Y-base)
                pivotWest.rotation.z = -angleRad; // C1 (Left)
                pivotEast.rotation.z = angleRad;  // C2 (Right)
                
                pivotNorth.rotation.x = angleRad;   // M1 (Back)
                pivotSouth.rotation.x = -angleRad;  // M2 (Front)
                pivotFarEast.rotation.z = angleRad; // Y2 (Top)
            };
            
            return { group: baseFace, updateFunc };
        }

        /** 전개도 3 (3-1.html): Z형 (Y-base) */
        function buildLayout3() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            const pivotNorth = createPivot(-offset, 0, -offset); // pivotWest 기준
            const faceNorth = createFace(colorMagenta, "North");
            faceNorth.position.set(0, 0, -offset); 
            pivotNorth.add(faceNorth);
            pivotWest.add(pivotNorth); 

            const pivotSouth = createPivot(0, 0, offset); 
            const faceSouth = createFace(colorMagenta, "Front");
            faceSouth.position.set(0, 0, offset); 
            pivotSouth.add(faceSouth);
            baseFace.add(pivotSouth); 

            const pivotEast = createPivot(offset, 0, 0);
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0);
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotFarEast = createPivot(size, 0, 0); // pivotEast 기준
            const faceFarEast = createFace(colorYellow, "FarEast");
            faceFarEast.position.set(offset, 0, 0);
            pivotFarEast.add(faceFarEast);
            pivotEast.add(pivotFarEast); 

            const updateFunc = (angleRad) => {
                pivotWest.rotation.z = -angleRad; 
                pivotSouth.rotation.x = -angleRad; 
                pivotEast.rotation.z = angleRad;  
                pivotNorth.rotation.x = angleRad; 
                pivotFarEast.rotation.z = angleRad; 
            };

            return { group: baseFace, updateFunc };
        }

        /** 전개도 4 (4-1.html): Z형 (Y-base) */
        function buildLayout4() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            const pivotNorth = createPivot(-offset, 0, -offset); // pivotWest 기준
            const faceNorth = createFace(colorMagenta, "North");
            faceNorth.position.set(0, 0, -offset); 
            pivotNorth.add(faceNorth);
            pivotWest.add(pivotNorth);

            const pivotEast = createPivot(offset, 0, 0);
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0);
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotSouth = createPivot(offset, 0, offset); // pivotEast 기준
            const faceSouth = createFace(colorMagenta, "South");
            faceSouth.position.set(0, 0, offset); 
            pivotSouth.add(faceSouth);
            pivotEast.add(pivotSouth); 

            const pivotFarEast = createPivot(size, 0, 0); // pivotEast 기준
            const faceFarEast = createFace(colorYellow, "FarEast");
            faceFarEast.position.set(offset, 0, 0);
            pivotFarEast.add(faceFarEast);
            pivotEast.add(pivotFarEast); 

            const updateFunc = (angleRad) => {
                pivotWest.rotation.z = -angleRad; 
                pivotEast.rotation.z = angleRad;  
                pivotNorth.rotation.x = angleRad;   
                pivotSouth.rotation.x = -angleRad;  
                pivotFarEast.rotation.z = angleRad; 
            };

            return { group: baseFace, updateFunc };
        }

        /** 전개도 5 (5-1.html): Z형 (Y-base) */
        function buildLayout5() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            const pivotNorth = createPivot(-offset, 0, -offset); // pivotWest 기준
            const faceNorth = createFace(colorMagenta, "North");
            faceNorth.position.set(0, 0, -offset); 
            pivotNorth.add(faceNorth);
            pivotWest.add(pivotNorth); 

            const pivotEast = createPivot(offset, 0, 0);
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0);
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotFarEast = createPivot(size, 0, 0); // pivotEast 기준
            const faceFarEast = createFace(colorYellow, "FarEast");
            faceFarEast.position.set(offset, 0, 0);
            pivotFarEast.add(faceFarEast);
            pivotEast.add(pivotFarEast); 

            const pivotSouth = createPivot(offset, 0, offset); // pivotFarEast 기준
            const faceSouth = createFace(colorMagenta, "South");
            faceSouth.position.set(0, 0, offset); 
            pivotSouth.add(faceSouth);
            pivotFarEast.add(pivotSouth); 

            const updateFunc = (angleRad) => {
                pivotWest.rotation.z = -angleRad; 
                pivotEast.rotation.z = angleRad;  
                pivotNorth.rotation.x = angleRad;   
                pivotSouth.rotation.x = -angleRad;  
                pivotFarEast.rotation.z = angleRad; 
            };

            return { group: baseFace, updateFunc };
        }
        
        /** 전개도 6 (6.html): Z형 (Y-base) */
        function buildLayout6() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotLeft = createPivot(-offset, 0, 0);
            const faceLeft = createFace(colorCyan, "Left");
            faceLeft.position.set(-offset, 0, 0);
            pivotLeft.add(faceLeft);
            baseFace.add(pivotLeft);

            const pivotRight = createPivot(offset, 0, 0);
            const faceRight = createFace(colorCyan, "Right");
            faceRight.position.set(offset, 0, 0);
            pivotRight.add(faceRight);
            baseFace.add(pivotRight);

            const pivotFarRight = createPivot(size, 0, 0); 
            const faceFarRight = createFace(colorYellow, "FarRight");
            faceFarRight.position.set(offset, 0, 0);
            pivotFarRight.add(faceFarRight);
            pivotRight.add(pivotFarRight); 

            const pivotBack = createPivot(0, 0, -offset);
            const faceBack = createFace(colorMagenta, "Back");
            faceBack.position.set(0, 0, -offset);
            pivotBack.add(faceBack);
            baseFace.add(pivotBack);

            const pivotFront = createPivot(offset, 0, offset); 
            const faceFront = createFace(colorMagenta, "Front");
            faceFront.position.set(0, 0, offset);
            pivotFront.add(faceFront);
            pivotRight.add(pivotFront);

            const updateFunc = (angleRad) => {
                pivotLeft.rotation.z = -angleRad; 
                pivotRight.rotation.z = angleRad; 
                pivotFarRight.rotation.z = angleRad;
                pivotBack.rotation.x = angleRad;   
                pivotFront.rotation.x = -angleRad; 
            };
            
            return { group: baseFace, updateFunc };
        }

        /** 전개도 7 (7.html): Z형 (Y-base) */
        function buildLayout7() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            const pivotEast = createPivot(offset, 0, 0); 
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0); 
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotTopLeft = createPivot(offset, 0, -offset);
            const faceTopLeft = createFace(colorMagenta, "TopLeft");
            faceTopLeft.position.set(0, 0, -offset); 
            pivotTopLeft.add(faceTopLeft);
            pivotEast.add(pivotTopLeft); 

            const pivotTopMid = createPivot(offset, 0, -offset);
            const faceTopMid = createFace(colorYellow, "TopMid");
            faceTopMid.position.set(offset, 0, 0); 
            pivotTopMid.add(faceTopMid);
            pivotTopLeft.add(pivotTopMid); 

            const pivotTopRight = createPivot(size, 0, 0);
            const faceTopRight = createFace(colorMagenta, "TopRight");
            faceTopRight.position.set(offset, 0, 0); 
            pivotTopRight.add(faceTopRight);
            pivotTopMid.add(pivotTopRight); 

            const updateFunc = (angleRad) => {
                pivotWest.rotation.z = -angleRad; 
                pivotEast.rotation.z = angleRad;  
                pivotTopLeft.rotation.x = angleRad;   
                pivotTopMid.rotation.z = angleRad;    
                pivotTopRight.rotation.z = angleRad; 
            };
            
            return { group: baseFace, updateFunc };
        }

        /** 전개도 8 (8.html): Z형 (Y-base) */
        function buildLayout8() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            const pivotEast = createPivot(offset, 0, 0); 
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0); 
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotBack = createPivot(offset, 0, -offset); // pivotEast 기준
            const faceBack = createFace(colorMagenta, "Back");
            faceBack.position.set(0, 0, -offset); 
            pivotBack.add(faceBack);
            pivotEast.add(pivotBack); 

            const pivotFront = createPivot(offset, 0, offset); // pivotEast 기준
            const faceFront = createFace(colorMagenta, "Front");
            faceFront.position.set(0, 0, offset); 
            pivotFront.add(faceFront);
            pivotEast.add(pivotFront); 

            const pivotTop = createPivot(offset, 0, -offset); // pivotBack 기준
            const faceTop = createFace(colorYellow, "Top");
            faceTop.position.set(offset, 0, 0); 
            pivotTop.add(faceTop);
            pivotBack.add(pivotTop); 

            const updateFunc = (angleRad) => {
                pivotWest.rotation.z = -angleRad; 
                pivotEast.rotation.z = angleRad;  
                pivotFront.rotation.x = -angleRad;
                pivotBack.rotation.x = angleRad;   
                pivotTop.rotation.z = angleRad;    
            };
            
            return { group: baseFace, updateFunc };
        }
        
        /** 전개도 9 (9.html): Z형 (Y-base) */
        function buildLayout9() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            const pivotEast = createPivot(offset, 0, 0); 
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0); 
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotBack = createPivot(offset, 0, -offset); // pivotEast 기준
            const faceBack = createFace(colorMagenta, "Back");
            faceBack.position.set(0, 0, -offset); 
            pivotBack.add(faceBack);
            pivotEast.add(pivotBack); 

            const pivotTop = createPivot(offset, 0, -offset); // pivotBack 기준
            const faceTop = createFace(colorYellow, "Top");
            faceTop.position.set(offset, 0, 0); 
            pivotTop.add(faceTop);
            pivotBack.add(pivotTop); 

            const pivotFront = createPivot(0, 0, offset); // baseFace 기준
            const faceFront = createFace(colorMagenta, "Front");
            faceFront.position.set(0, 0, offset); 
            pivotFront.add(faceFront);
            baseFace.add(pivotFront); 

            const updateFunc = (angleRad) => {
                pivotWest.rotation.z = -angleRad; 
                pivotEast.rotation.z = angleRad;  
                pivotFront.rotation.x = -angleRad; 
                pivotBack.rotation.x = angleRad;   
                pivotTop.rotation.z = angleRad;    
            };
            
            return { group: baseFace, updateFunc };
        }
        
        /** 전개도 10 (10.html): Z형 (Y-base) */
        function buildLayout10() {
            const baseFace = createFace(colorYellow, "Base"); // Yellow
            
            const pivotWest = createPivot(-offset, 0, 0); 
            const faceWest = createFace(colorCyan, "West");
            faceWest.position.set(-offset, 0, 0); 
            pivotWest.add(faceWest);
            baseFace.add(pivotWest);

            const pivotEast = createPivot(offset, 0, 0); 
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0); 
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotBack = createPivot(offset, 0, -offset); // pivotEast 기준
            const faceBack = createFace(colorMagenta, "Back");
            faceBack.position.set(0, 0, -offset); 
            pivotBack.add(faceBack);
            pivotEast.add(pivotBack); 

            const pivotTop = createPivot(offset, 0, -offset); // pivotBack 기준
            const faceTop = createFace(colorYellow, "Top");
            faceTop.position.set(offset, 0, 0); 
            pivotTop.add(faceTop);
            pivotBack.add(pivotTop); 

            const pivotFront = createPivot(-offset, 0, offset); // pivotWest 기준
            const faceFront = createFace(colorMagenta, "Front");
            faceFront.position.set(0, 0, offset); 
            pivotFront.add(faceFront);
            pivotWest.add(pivotFront); 

            const updateFunc = (angleRad) => {
                pivotWest.rotation.z = -angleRad; 
                pivotEast.rotation.z = angleRad;  
                pivotFront.rotation.x = -angleRad; 
                pivotBack.rotation.x = angleRad;   
                pivotTop.rotation.z = angleRad;    
            };
            
            return { group: baseFace, updateFunc };
        }

        /** 전개도 11 (11.html): 계단식 (M-base) */
        function buildLayout11() {
            const baseFace = createFace(colorMagenta, "Base"); // Magenta
            
            const pivotSouth = createPivot(0, 0, offset); 
            const faceSouth = createFace(colorYellow, "South");
            faceSouth.position.set(0, 0, offset); 
            pivotSouth.add(faceSouth);
            baseFace.add(pivotSouth);

            const pivotSouthWest = createPivot(-offset, 0, offset); // pivotSouth 기준
            const faceSouthWest = createFace(colorCyan, "SouthWest");
            faceSouthWest.position.set(-offset, 0, 0); 
            pivotSouthWest.add(faceSouthWest);
            pivotSouth.add(pivotSouthWest);

            const pivotEast = createPivot(offset, 0, 0); 
            const faceEast = createFace(colorCyan, "East");
            faceEast.position.set(offset, 0, 0); 
            pivotEast.add(faceEast);
            baseFace.add(pivotEast);

            const pivotNorth = createPivot(offset, 0, -offset); // pivotEast 기준
            const faceNorth = createFace(colorYellow, "North"); 
            faceNorth.position.set(0, 0, -offset); 
            pivotNorth.add(faceNorth);
            pivotEast.add(pivotNorth); 

            const pivotNorthEast = createPivot(offset, 0, -offset); // pivotNorth 기준
            const faceNorthEast = createFace(colorMagenta, "NorthEast"); 
            faceNorthEast.position.set(offset, 0, 0); 
            pivotNorthEast.add(faceNorthEast);
            pivotNorth.add(pivotNorthEast); 

            const updateFunc = (angleRad) => {
                pivotSouth.rotation.x = -angleRad;
                pivotSouthWest.rotation.z = -angleRad;
                pivotEast.rotation.z = angleRad;
                pivotNorth.rotation.x = angleRad;
                pivotNorthEast.rotation.z = angleRad;
            };

            return { group: baseFace, updateFunc };
        }


        // --- 4. 메인 로직 (레이아웃 교체) ---

        function loadLayout(layoutId) {
            // 기존 큐브 제거
            if (currentCubeGroup) {
                scene.remove(currentCubeGroup);
                currentCubeGroup.traverse(child => {
                    if (child.isMesh) {
                        child.geometry.dispose();
                        child.material.dispose();
                    } else if (child.isLineSegments) {
                        child.geometry.dispose();
                        child.material.dispose();
                    }
                });
            }

            let layout;
            switch(layoutId) {
                case 'layout-1': layout = buildLayout1(); break;
                case 'layout-2': layout = buildLayout2(); break;
                case 'layout-3': layout = buildLayout3(); break;
                case 'layout-4': layout = buildLayout4(); break;
                case 'layout-5': layout = buildLayout5(); break;
                case 'layout-6': layout = buildLayout6(); break;
                case 'layout-7': layout = buildLayout7(); break;
                case 'layout-8': layout = buildLayout8(); break;
                case 'layout-9': layout = buildLayout9(); break;
                case 'layout-10': layout = buildLayout10(); break;
                case 'layout-11': layout = buildLayout11(); break;
                default: layout = buildLayout1();
            }

            currentCubeGroup = layout.group;
            currentUpdateFunction = layout.updateFunc;
            scene.add(currentCubeGroup);

            // 슬라이더 리셋 및 0도 상태로 업데이트
            slider.value = 0;
            currentUpdateFunction(0);

            // 활성 버튼 스타일 업데이트
            buttons.forEach(btn => {
                btn.classList.toggle('active', btn.id === `btn-${layoutId}`);
            });
        }

        // --- 5. 이벤트 리스너 및 애니메이션 루프 ---

        // 슬라이더 이벤트
        slider.addEventListener('input', () => {
            if (currentUpdateFunction) {
                const angleRad = THREE.MathUtils.degToRad(slider.value);
                currentUpdateFunction(angleRad);
            }
        });

        // 윈도우 리사이즈
        window.addEventListener('resize', () => {
            camera.aspect = canvasContainer.clientWidth / canvasContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
        }, false);

        // 썸네일 버튼 클릭 이벤트
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const layoutId = btn.id.replace('btn-', ''); // 'btn-layout-1' -> 'layout-1'
                loadLayout(layoutId);
            });
        });

        // 렌더링 루프
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // --- 6. 초기 실행 ---
        animate();
        loadLayout('layout-1'); // 첫 로드 시 1번 전개도 표시

    </script>
</body>
</html>